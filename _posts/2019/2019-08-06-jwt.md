---
title:  "JWT!"

read_time: false
share: false
author_profile: false
classes: wide

categories:
  - javascript

tags:
  - json
  - jwt

toc: true

---

## JWT (JSON Web Token)

웹상에서 전달되는 인증객체, 개인만이 아는 데이터(비밀번호 등)의 해쉬화된 값이 서명역할을 할 수 있다.  

웹으로 전달하는 데이터가 정말 본인이 작성한게 맞는지 확인할 때 이 라이브러리를 사용하면 간단하게 해결할 수 있다.  

> https://jwt.io/

## JWT 구조

![jwt1]({{ "/assets/2019/jwt1.png" | absolute_url }}){: .shadow}  

그림처럼 3부분으로 나뉜다.  

`Header`, `Payload(Claim Set)`, `Signature`

Header와 Payload는 단순 Base64로 인코딩된 문자열로 아래같은 사이트에서 디코딩하면 확인할 수 있다.  
> https://www.base64decode.org/  

![jwt2]({{ "/assets/2019/jwt2.png" | absolute_url }}){: .shadow}  

최종적인 결과 : `Header + "." + Payload(Claim Set) + "." + Signature`


Header와 Payload는 암호화 되지 않기때문에 위변조가 가능하며 중요한 데이터를 처리하거나 넣는 일이 발생하면 안된다.  

딱 해당 유저가 보낸 토큰이구나 확인할수 정도로 운영한다.  



## 스프링에서 jwt사용

```xml
<dependency>
  <groupId>com.auth0</groupId>
  <artifactId>java-jwt</artifactId>
  <version>3.4.0</version>
</dependency>
```

```java
@Data
@RedisHash("mid")
public class Member {
    @Id
    private String mid;
    private String mpw;
    private String mname;
}
```

```java
@Controller
@Log
@RequestMapping("/jwt")
public class MemberController {
    @Autowired
    RedisTemplate<?, ?> redisTemplate;

    @Autowired
    MemberRedisRepository memberRepo;

    @GetMapping("/join")
    public void joinGET() {
        log.info("joinGET() called...");
    }

    @PostMapping("/join")
    public String joinPOST(Member member, RedirectAttributes rttr) {
        log.info("joinPOST() called...");
        memberRepo.save(member);
        Date date = new Date(System.currentTimeMillis() + 1000 * 60 * 10); //10분
        Algorithm algorithm = Algorithm.HMAC256(member.getMpw());
        String jwt = JWT.create()
                .withClaim("name", member.getMname())
                .withExpiresAt(date)
                .sign(algorithm);
        rttr.addAttribute("jwt", jwt);
        return "redirect:/jwt/main";
    }

    @GetMapping("/login")
    public void loginGET() {
        log.info("loginGET() called...");
    }

    @PostMapping("/login")
    public String loginPOST(Member member, Model model, HttpServletRequest request, RedirectAttributes rttr) {
        log.info("loginPOST() called...");
        Member newMem = memberRepo.findById(member.getMid()).get();
        if(newMem.getMpw().equals(member.getMpw())){
            log.info("login success");
            Date date = new Date(System.currentTimeMillis() + 1000 * 60 * 10); //10분
            Algorithm algorithm = Algorithm.HMAC256(member.getMpw());

            String jwt = JWT.create()
                    .withClaim("name", newMem.getMname())
                    .withExpiresAt(date)
                    .sign(algorithm);
            rttr.addAttribute("jwt", jwt);
            return "redirect:/jwt/main";
        }
        else {
            log.info("login fail.. ");
            return "redirect:/jwt/main";
        }
    }

    @GetMapping("/main")
    public void main() {
    }
}
```

`join`, `login`을 post 요청으로 요청시 회원가입, 로그인 처리시 jwt토큰을 발급해준다.  

앞으로 해당 토큰이 서버의 요청에 파라미터로 포함되어 있으면 로그인 했단 증명이 된다.  

