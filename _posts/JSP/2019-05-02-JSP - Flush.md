---
title:  "JSP/Servlet - out.flush, !"

read_time: false
share: false
author_profile: false
classes: wide

categories:
  - JSP

tags:
  - JSP
  - servelt

toc: true

---

## JSP 버퍼

서버에서 클라이언트에게 데이터를 전송하는 과정은 다음과 같다.  

![image16]({{ "/assets/jsp/image16.png" | absolute_url }}){: .shadow}  

클라이언트의 요청이 일어나면 jsp에서 만들어진 서블릿 객체가 `out.print()`메서드를 통해 버퍼에 출력할 값들을 저장한다.  

![image15]({{ "/assets/jsp/image15.png" | absolute_url }}){: .shadow}  

일정이상의 버퍼가 모두 차면 클라이언트의 브라우저로 전송되며 출력되게 된다.  

자동으로 버퍼가 모두 차면 `flush`되도록 설정하려면 디렉티브(지시자)에 다음 설정이 있어야 한다  
`autoFlush="true"`  

`autoFlush`의 기본값이 true이기 때문에 `autoFlush="false"`별도 기입하지 않는 이상 자동으로 버퍼가 `flush`된다.  

버퍼의 크기는 `buffer="1kb"` 속성으로 지정할 수 있다.  

```js
<%@ page language="java" contentType="text/html; charset=UTF-8" pageEncoding="UTF-8"
	autoFlush="false" buffer="1kb"
%>
```
디렉티브를 위와 같이 설정했을때 만약 버퍼가 다 차면 어떻게 되는지 보자.  

```js
<%
for(int i=0; i<1000; i++)
{
%>
	1234
<% 
}
%>
```
`java.io.IOException: Error: JSP Buffer overflow`예외가 발생한다.  

```js
<%
for(int i=0; i<1000; i++)
{
	if(i%20==0)
		out.flush();
%>
	1234
<% 
}
%>
```
중간중간에 `flush()`메서드를 설정하면 오류는 나지 않는다.

`out.clear()`메서드가 있는데 `flush()`는 클라이언트에게 보내고 비우는 거라면  
`clear()`는 보내지 않고 바로 비운다. 


웹 기본 구조

이클립스에서 하다 보니 실제 아파치를 깔면 에다 저장해야 한다.  

가장 상위폴더는 webapp폴더이고 Root의 경우 특별히 url생략 가능하다.  

webapp하위의 폴더들이 contextpath가 되며 

## 기본객체 - pageContext

pageContext를 통해서 다른 기본객체를 얻어올 수 있다.  


지금까지 `<% %>`스트릿코드안에서 바로 `request`객체를 사용해왔다.

pageContext를 통해서도 가져올 수 있다.

```java
requset = (HttpServletRequest)pageContext.getRequest();
response = (HttpServletResponse)pageContext.gerResponse();
session = pageContext.getSession();
application = pageContext.servletContext();
out = pageContext.getOut();;
exception = pageContext.getExecption();
page = pageContext.getPage();
```

page
(다운캐스팅 해주어야함)


## 기본객체 - application

application객체

웹어플리케이션(웹사이트 전체)과 관련되있는 객체를 application 객체라 한다.  
웹어플리케이션 전반적인 정보를 가지고 있다.

web.xml에 <init-param>태그가 있는데 하나의 서블릿 객체 초기화시 필요한 파라미터를 설정하는 태그이다.  

웹사이트 전체적으로(모든 서블릿에게) 매개변수를 주고싶다면 <context-param>을 사용하면 된다.
<context-param>에서 매개변수를 사용하려면 application의
getInitParameter("파라미터명")와 getInitParameterNames() 메서드를 사용한다.  

web.xml에 아래와 같이 설정하자
```xml
<context-param>
	<description>디버깅 레벨</description>
	<param-name>debugLevel</param-name>
	<param-value>5</param-value>
</context-param>
```

<% 
Enumeration<String> en = application.getInitParameterNames();
while(en.hasMoreElements())
{
	String pname = en.nextElement();
	String pval = application.getInitParameter(pname);
	out.print(pname +": " + pval +"<br>");
}
%>