---
title:  "JSP/Servlet - 파일 업로드 !"

read_time: false
share: false
author_profile: false
classes: wide

categories:
  - JSP

tags:
  - JSP
  - servelt

toc: true

---

## 파일 업로드

무조건 post방식

두가지 인코딩 방식에 따라 전송하는 데이터 형식이 달라진다.

파일 전송시에는 `multipart/form-data`  방식을 ㅅ용하자
```
<form method="post" enctype="multipart/form-data">
...
</form>
```

기존에는 파일 업로드용 API가 별도로 필요했지만 서블릿 3.0부터는 라이브러리 없이 사용 가능하다.  

## 라이브러리 없이 하는 방법

```
<form action="ex01_01.jsp" method="post" enctype="multipart/form-data">
	이름: <input type="text" name="name" value="홍길동"/>
	파일: <input type="file" name="upload"/>
	<input type="submit" />
</form>
```


```
<body>
<% 
String name = request.getParameter("name");
String upload = request.getParameter("upload");
%>
전송된 이름: <%= name %> <br>
전송된 파일: <%= upload %> <br>
<hr>
${ param.name }
${ param.upload }
</body>
```

위파일에서 전달받아도 null로 출력만된다.

requset.getParameter()로는 multipart/form-data형식으로 보낸 값은 받을수 없다.  

`multipart/form-data`방식으로 전송할 때 스트림 방식으로 전송된다.  

```
<%@page import="java.io.DataInputStream"%>
<%@page import="java.util.Enumeration"%>
<%@ page contentType="text/html; charset=UTF-8" pageEncoding="UTF-8"%>
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core"%>
<%
   request.setCharacterEncoding("UTF-8");  
   // String contentType = request.getContentType();
   Enumeration<String> en = request.getHeaderNames();
   out.println("> 전송받은 헤더 정보 출력<br>");
   while( en.hasMoreElements() ){
	   String key = en.nextElement();
	   String value = request.getHeader(key);
	   out.println(key+" : "+ value + "<br>");
   }
   
   out.println("<br>> 전송받은 데이터 출력<br>");
   ServletInputStream sis= request.getInputStream();
   DataInputStream dis = new DataInputStream(sis);
   String line = "";
   while( ( line = dis.readLine() ) != null ){
	   out.println( new String( 
			   line.getBytes("ISO-8859-1"), "UTF-8" ) +"<br>" );
   }
%>
```


## 라이브러리 사용하기


우리는 아래 사이트에서 제공하는 라이브러리를 사용하자.

> http://www.servlets.com/cos/

`cos-20.08.zip`파일을 다운받고 `cos.jar`파일을 lib폴더에 추가한다.  

```
> 이름 : 홍길동
> 첨부된 파일명 : data1.txt
>>> originalFileName : data.txt 
>>> filesystemName : data1.txt 
> 첨부된 파일 크기 : 9223 bytes 
```

실제위치 C:\Class\JSPClass\.metadata\.plugins\org.eclipse.wst.server.core\tmp0\wtpwebapps\jspPro\days23\upload

```
data.txt
data1.txt
data2.txt
```